# 1101接口对应的人员信息表结构

## 1. 主表：人员基本信息表 (person_basic_info)

```sql
-- 人员基本信息表（1101接口 - baseinfo节点）
CREATE TABLE person_basic_info (
    id BIGSERIAL PRIMARY KEY,
    
    -- 人员唯一标识
    psn_no VARCHAR(30) NOT NULL UNIQUE,                 -- 人员编号
    
    -- 证件信息
    psn_cert_type VARCHAR(6) NOT NULL,                  -- 人员证件类型
    certno VARCHAR(50) NOT NULL,                        -- 证件号码
    psn_name VARCHAR(50) NOT NULL,                      -- 人员姓名
    
    -- 基本信息
    gend VARCHAR(6),                                     -- 性别
    naty VARCHAR(3),                                     -- 民族
    brdy DATE,                                           -- 出生日期
    age DECIMAL(4,1),                                    -- 年龄
    
    -- 扩展信息
    exp_content VARCHAR(4000),                           -- 字段扩展
    
    -- 同步相关
    sync_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- 同步时间
    data_version VARCHAR(50),                            -- 数据版本号
    
    -- 审计字段
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 创建索引
CREATE INDEX idx_person_basic_info_psn_no ON person_basic_info(psn_no);
CREATE INDEX idx_person_basic_info_certno ON person_basic_info(certno);
CREATE INDEX idx_person_basic_info_psn_name ON person_basic_info(psn_name);
CREATE INDEX idx_person_basic_info_psn_cert_type ON person_basic_info(psn_cert_type);
CREATE INDEX idx_person_basic_info_sync_time ON person_basic_info(sync_time);
```

## 2. 参保信息表 (person_insurance_info)

```sql
-- 人员参保信息表（1101接口 - insuinfo节点）
CREATE TABLE person_insurance_info (
    id BIGSERIAL PRIMARY KEY,
    
    -- 关联主表
    psn_no VARCHAR(30) NOT NULL,                        -- 人员编号
    
    -- 参保信息
    balc DECIMAL(16,2),                                  -- 余额
    insutype VARCHAR(6) NOT NULL,                       -- 险种类型
    psn_type VARCHAR(6),                                 -- 人员类别
    psn_insu_stas VARCHAR(6),                            -- 人员参保状态
    psn_insu_date DATE,                                  -- 个人参保日期
    paus_insu_date DATE,                                 -- 暂停参保日期
    cvlserv_flag VARCHAR(3),                             -- 公务员标志
    insuplc_admdvs VARCHAR(6),                           -- 参保地医保区划
    emp_name VARCHAR(200),                               -- 单位名称
    
    -- 同步相关
    sync_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- 同步时间
    data_version VARCHAR(50),                            -- 数据版本号
    
    -- 审计字段
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- 外键约束
    CONSTRAINT fk_person_insurance_psn_no 
        FOREIGN KEY (psn_no) 
        REFERENCES person_basic_info(psn_no) 
        ON DELETE CASCADE
);

-- 创建索引
CREATE INDEX idx_person_insurance_info_psn_no ON person_insurance_info(psn_no);
CREATE INDEX idx_person_insurance_info_insutype ON person_insurance_info(insutype);
CREATE INDEX idx_person_insurance_info_psn_type ON person_insurance_info(psn_type);
CREATE INDEX idx_person_insurance_info_psn_insu_stas ON person_insurance_info(psn_insu_stas);
CREATE INDEX idx_person_insurance_info_insuplc_admdvs ON person_insurance_info(insuplc_admdvs);
CREATE INDEX idx_person_insurance_info_sync_time ON person_insurance_info(sync_time);
CREATE UNIQUE INDEX idx_person_insurance_info_unique ON person_insurance_info(psn_no, insutype);
```

## 3. 身份信息表 (person_identity_info)

```sql
-- 人员身份信息表（1101接口 - idetinfo节点）
CREATE TABLE person_identity_info (
    id BIGSERIAL PRIMARY KEY,
    
    -- 关联主表
    psn_no VARCHAR(30) NOT NULL,                        -- 人员编号
    
    -- 身份信息
    psn_idet_type VARCHAR(3) NOT NULL,                  -- 人员身份类别
    psn_type_lv VARCHAR(3),                             -- 人员类别等级
    memo VARCHAR(500),                                   -- 备注
    begntime TIMESTAMP,                                  -- 开始时间
    endtime TIMESTAMP,                                   -- 结束时间
    
    -- 同步相关
    sync_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- 同步时间
    data_version VARCHAR(50),                            -- 数据版本号
    
    -- 审计字段
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- 外键约束
    CONSTRAINT fk_person_identity_psn_no 
        FOREIGN KEY (psn_no) 
        REFERENCES person_basic_info(psn_no) 
        ON DELETE CASCADE
);

-- 创建索引
CREATE INDEX idx_person_identity_info_psn_no ON person_identity_info(psn_no);
CREATE INDEX idx_person_identity_info_psn_idet_type ON person_identity_info(psn_idet_type);
CREATE INDEX idx_person_identity_info_psn_type_lv ON person_identity_info(psn_type_lv);
CREATE INDEX idx_person_identity_info_begntime ON person_identity_info(begntime);
CREATE INDEX idx_person_identity_info_endtime ON person_identity_info(endtime);
CREATE INDEX idx_person_identity_info_sync_time ON person_identity_info(sync_time);
CREATE UNIQUE INDEX idx_person_identity_info_unique ON person_identity_info(psn_no, psn_idet_type, begntime);
```

## 4. 创建更新触发器

```sql
-- 创建更新时间触发器
CREATE TRIGGER update_person_basic_info_updated_at 
    BEFORE UPDATE ON person_basic_info 
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_person_insurance_info_updated_at 
    BEFORE UPDATE ON person_insurance_info 
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_person_identity_info_updated_at 
    BEFORE UPDATE ON person_identity_info 
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

## 5. 数据同步版本控制

```sql
-- 人员信息同步控制表
CREATE TABLE person_sync_control (
    id SERIAL PRIMARY KEY,
    sync_type VARCHAR(20) NOT NULL DEFAULT 'full',      -- full/incremental
    local_version VARCHAR(50),                           -- 本地版本号
    remote_version VARCHAR(50),                          -- 远程版本号
    last_sync_time TIMESTAMP,                            -- 最后同步时间
    next_sync_time TIMESTAMP,                            -- 下次同步时间
    sync_status VARCHAR(20) DEFAULT 'pending',           -- pending/running/completed/failed
    sync_record_count INTEGER DEFAULT 0,                 -- 同步记录数
    error_message TEXT,                                  -- 错误信息
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 6. 使用示例

### 6.1 数据插入示例

```sql
-- 插入基本信息
INSERT INTO person_basic_info (
    psn_no, psn_cert_type, certno, psn_name, gend, naty, brdy, age
) VALUES (
    'P12345678', '01', '110101198001010011', '张三', '1', '01', '1980-01-01', 45.0
);

-- 插入参保信息
INSERT INTO person_insurance_info (
    psn_no, balc, insutype, psn_type, psn_insu_stas, psn_insu_date, 
    cvlserv_flag, insuplc_admdvs, emp_name
) VALUES (
    'P12345678', 1500.00, '310', '11', '1', '2020-01-01', 
    '0', '110100', '北京市某某公司'
);

-- 插入身份信息
INSERT INTO person_identity_info (
    psn_no, psn_idet_type, psn_type_lv, memo, begntime, endtime
) VALUES (
    'P12345678', '01', '1', '正常职工', '2020-01-01 00:00:00', null
);
```

### 6.2 数据查询示例

```sql
-- 查询人员完整信息
SELECT 
    pbi.psn_no,
    pbi.psn_name,
    pbi.gend,
    pbi.brdy,
    pii.insutype,
    pii.psn_insu_stas,
    pii.balc,
    pii.emp_name,
    pidi.psn_idet_type,
    pidi.psn_type_lv
FROM person_basic_info pbi
LEFT JOIN person_insurance_info pii ON pbi.psn_no = pii.psn_no
LEFT JOIN person_identity_info pidi ON pbi.psn_no = pidi.psn_no
WHERE pbi.psn_no = 'P12345678';

-- 查询某个险种的参保人员
SELECT 
    pbi.psn_no,
    pbi.psn_name,
    pii.balc,
    pii.psn_insu_stas
FROM person_basic_info pbi
JOIN person_insurance_info pii ON pbi.psn_no = pii.psn_no
WHERE pii.insutype = '310' 
AND pii.psn_insu_stas = '1';

-- 查询需要同步的数据
SELECT * FROM person_basic_info 
WHERE sync_time < (
    SELECT last_sync_time FROM person_sync_control 
    WHERE sync_type = 'incremental'
);
```

### 6.3 数据更新示例

```sql
-- 更新人员基本信息
UPDATE person_basic_info 
SET psn_name = '张三三', 
    age = 45.5,
    sync_time = CURRENT_TIMESTAMP
WHERE psn_no = 'P12345678';

-- 更新参保状态
UPDATE person_insurance_info 
SET psn_insu_stas = '2',
    balc = 1200.00,
    sync_time = CURRENT_TIMESTAMP
WHERE psn_no = 'P12345678' 
AND insutype = '310';

-- 更新同步状态
UPDATE person_sync_control 
SET sync_status = 'completed',
    last_sync_time = CURRENT_TIMESTAMP,
    next_sync_time = CURRENT_TIMESTAMP + INTERVAL '1 hour',
    sync_record_count = 1500;
```

## 7. 表结构说明

### 7.1 设计原则
1. **数据规范化**：按照接口输出的三个节点分别建表
2. **主键设计**：使用自增主键，业务唯一键用唯一索引
3. **外键关联**：参保信息和身份信息通过psn_no关联基本信息
4. **索引优化**：为常用查询字段建立索引
5. **版本控制**：支持数据同步的版本管理

### 7.2 数据特点
- **person_basic_info**：一个人员对应一条记录
- **person_insurance_info**：一个人员可能有多个险种，一对多关系
- **person_identity_info**：一个人员可能有多个身份类别，一对多关系

### 7.3 查询优化
- 基本信息查询：主要通过psn_no和certno查询
- 参保信息查询：主要通过insutype和psn_insu_stas查询
- 身份信息查询：主要通过psn_idet_type和时间范围查询

### 7.4 同步机制
- 支持全量同步和增量同步
- 通过sync_time和data_version控制同步状态
- 支持同步失败重试机制

这个表结构设计完全对应1101接口的输入输出字段，支持高效的数据存储和查询，同时具备良好的扩展性和维护性。